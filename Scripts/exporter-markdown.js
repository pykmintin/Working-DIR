<a data-v-421b9f14="" href="/chat/19a81eda-7992-8f94-8000-09e2720d288a" class="history-link"><div data-v-421b9f14="" class="history-chat"><div data-v-421b9f14="" class="horizontal header"><div data-v-421b9f14="" class="title-wrapper"><!----> <!----> <span data-v-421b9f14="" class="title">BackupCleanPCTask</span> <!----><div data-v-421b9f14="" class="operation"><svg data-v-421b9f14="" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" role="img" width="1em" height="1em" viewBox="0 0 1024 1024" name="Edit" class="iconify action-icon"><path d="M736.085333 222.592a46.165333 46.165333 0 0 1 65.322667 65.28L336.426667 752.938667a132.266667 132.266667 0 0 1-61.44 34.773333l-51.541334 12.885333 12.885334-51.541333a132.266667 132.266667 0 0 1 34.773333-61.44L736.085333 222.592z m32.682667-90.325333c-32.64 0-63.914667 12.970667-86.997333 36.010666L216.832 633.258667a209.066667 209.066667 0 0 0-55.04 97.152l-28.373333 113.621333a38.4 38.4 0 0 0 46.549333 46.549333l113.621333-28.416a209.066667 209.066667 0 0 0 97.152-54.997333l361.813334-361.813333 103.168-103.125334A122.965333 122.965333 0 0 0 768.768 132.266667zM512 814.933333a38.4 38.4 0 1 0 0 76.8h298.666667a38.4 38.4 0 1 0 0-76.8h-298.666667z" fill="currentColor"></path></svg></div></div> <div data-v-421b9f14="" class="action-wrapper"><!----> <!----><div data-v-421b9f14="" class="operation"><svg data-v-421b9f14="" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" role="img" width="1em" height="1em" viewBox="0 0 1024 1024" name="PinToTop" class="iconify action-icon"><path d="M576 554.666667h160.341333a4.266667 4.266667 0 0 0 3.029334-7.253334l-2.986667-3.072-48.341333-48.298666-18.176-18.176-151.850667-151.850667a8.533333 8.533333 0 0 0-12.032 0L354.133333 477.866667l-18.176 18.176L287.573333 544.426667l-2.986666 2.986666a4.266667 4.266667 0 0 0 2.986666 7.253334H448v290.133333c0 4.736 3.84 8.533333 8.533333 8.533333h110.933334a8.533333 8.533333 0 0 0 8.533333-8.533333V554.666667z m160.384 76.8H652.8v213.333333a85.333333 85.333333 0 0 1-85.333333 85.333333h-110.933334a85.333333 85.333333 0 0 1-85.333333-85.333333v-213.333333H287.616c-72.192 0-108.373333-87.338667-57.301333-138.410667l221.354666-221.312a85.333333 85.333333 0 0 1 120.661334 0l221.354666 221.312c51.072 51.072 14.933333 138.410667-57.301333 138.410667zM256 89.6a38.4 38.4 0 0 0 0 76.8h512a38.4 38.4 0 1 0 0-76.8H256z" fill="currentColor"></path></svg></div><!----> <!----><div data-v-421b9f14="" class="operation"><svg data-v-421b9f14="" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" role="img" width="1em" height="1em" viewBox="0 0 1024 1024" name="Delete" class="iconify delete-icon action-icon"><path d="M352.256 155.648c0-20.48 16.384-36.864 36.864-36.864h245.76c20.48 0 36.864 16.384 36.864 36.864s-16.384 36.864-36.864 36.864H389.12c-20.48 0-36.864-16.384-36.864-36.864zM430.08 684.032c-20.48 0-36.864-16.384-36.864-36.864v-204.8c0-20.48 16.384-36.864 36.864-36.864s36.864 16.384 36.864 36.864v204.8c0 20.48-16.384 36.864-36.864 36.864zM557.056 647.168c0 20.48 16.384 36.864 36.864 36.864s36.864-16.384 36.864-36.864v-204.8c0-20.48-16.384-36.864-36.864-36.864s-36.864 16.384-36.864 36.864v204.8z" fill="currentColor"></path><path d="M880.64 241.664H143.36c-20.48 0-36.864 16.384-36.864 36.864s16.384 36.864 36.864 36.864h49.152l40.96 483.328c4.096 49.152 45.056 90.112 98.304 90.112h364.544c49.152 0 94.208-40.96 98.304-90.112l40.96-483.328H880.64c20.48 0 36.864-16.384 36.864-36.864s-16.384-36.864-36.864-36.864z m-159.744 548.864c0 12.288-12.288 24.576-24.576 24.576h-368.64c-12.288 0-24.576-8.192-24.576-24.576L266.24 315.392h491.52l-36.864 475.136z" fill="currentColor"></path></svg></div><!----></div> <div data-v-421b9f14="" class="date">Saturday</div></div> <div data-v-421b9f14="" class="content"># **Version Comparison: dirmapper**

| Version | `__version__` | Purpose | Input Method | Output | Use Case |
|---------|---------------|---------|--------------|--------|----------|
| **v6.3.1** | `6.3.1` | Corelink Queue Integration | `stdin` (JSON payload) | Prints `"SUCCESS"` | **Automated pipeline** |
| **v6.3** | `6.3` | Standalone CLI | `argparse` (`--root`, `--repo`, etc.) | Prints JSON result | **Manual/scheduled runs** |

---

## **Answer: v6.3.1 is the latest by version number**

**But they serve different purposes:**

- **Use v6.3.1** if you're running it via `CoreCompile.py` queue system
- **Use v6.3** if you're running it manually from command line

**Recommendation:** Keep both, rename them:
```
dirmapper_corelink.py  (v6.3.1 - for queue)
dirmapper_cli.py       (v6.3 - for manual use)
```</div> <div data-v-ca53c472="" data-v-421b9f14="" class="history-attachment-list"><div data-v-a55b5748="" data-v-ca53c472="" class="carousel-container"><!----> <div data-v-a55b5748="" class="arrow-action right"><span data-v-a55b5748="" class="arrow"><svg data-v-a55b5748="" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" role="img" width="1em" height="1em" viewBox="0 0 1024 1024" name="Left_b" class="iconify"><path d="M342.99904 549.23264a36.864 36.864 0 0 1 0.08192-52.0192l285.696-285.696a36.864 36.864 0 1 1 52.14208 52.10112l-259.6864 259.72736 259.76832 261.69344a36.864 36.864 0 0 1-52.30592 51.93728L342.99904 549.2736z" fill="currentColor"></path></svg></span></div> <div data-v-a55b5748="" class="carousel-scroll"><div data-v-90c66f3f="" data-v-ca53c472="" class="file-card-container normal success"><img data-v-90c66f3f="" class="file-card-icon" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFAAAABQCAMAAAC5zwKfAAAAZlBMVEUAAACT1ZNQoU9Qok9QoFBQn1BQoE9QoU9Qn1BQok9QolBQoU////+T1JLp8+nT59NmrWVbp1q93L18uXuRxJH0+fSo0Kfe7d7I4si9271xs3CHv4adypyRxZGGvoay1rJ3v3aIy4ejmNDEAAAAC3RSTlMAf++/cCCA3xCfoGQ/qNYAAALaSURBVFjD7djddqIwEADgrqhtd6b5MST8a/v+L7lMog6oUYm52XM6F8rAyWdgAsS8TeJjW7zDkvjzdi82BSyNr3viegXLwTviFiABjItrSAKj4maVBkbFT0gDY+IGEsGYuE4FY2KRCP7ExFUi+P0VESEx1FdEhNT4joiQHD9zkcFcfXwMqq4DDt0ZBfPQ3zdqHeckItacN5QqiMVDUAkcY8c7asqFTgWpQ9Uw6OkpDwLRJYMV94ZNiyIZRJRwFTILqPsyL1jTZk4QEW1WUNLoeRlsGdRlr18GJQ3qjFVWOMYeOLg+okwBoRR8H09ij2OoV4vS1lJNHhASXgUFYnW+hrbNMg4x6zh0uUFoc4MGqwygPYNG5Lj1QKDVp74KFba0wCoZdKMzdGQeb2U9DBXiLhWk3ly99aivySCo+vqtJ5Neo0yaTgNH1xGXAsbjF/wF/29QKz1PFW8vAI2UNX07Qc+BRh0Fn2JVhtw4btBL6e6B5cj4ueYxSt/InlKx9yCyuEPcPQZ73z1pw7PKEWWr8CO9B7FZBo5tDz4r6YN046dMdOLGg1jpJeBsWiP4oaosovQg7VsAju0qxXt4LkOUCSCJT4OSGjTmcjoM/qccgV5snwZbG1qUVHAiZkUlUDgq1P5ZEFpBoL/041Y5exNKD0Lpa/4kSBvSi5LAno8fPMin4Z4EKdSORFVzCwgDyoOn/4L2OZBruu/HRno6UTYBPIkPwMbXVKuQEagtl1kLojwY/CoO6kN7HHTlyIZ5eeuHoDu/3k3lDzMIuo6BRoytGiqE0J4VjWuOfRsb0cGGOHTAIMUhAlLJfNj2dG34bjiEJHgXILibYKgpT11KyRkJIbW1gTPIYqwo2gyTiYziLBzshpbzWbSX4DtkiRUvpuUBC16AzQOueQE7D7h5y3vOn5FF3eSSbGaLprmuYL66bHMs3XOs1jfWnv+mewVfvxm5LhK6+V5sPybIPyq5/zTpURoxAAAAAElFTkSuQmCC" alt="json"> <div data-v-90c66f3f="" class="file-card-info"><p data-v-90c66f3f="" class="file-card-info-name">diagnostic_manifest_batch.json</p> <div data-v-90c66f3f="" class="file-card-info-status"><p data-v-90c66f3f="" class="file-card-info-size">47.32 KB</p></div></div> <!----></div> <!----> <!----><div data-v-90c66f3f="" data-v-ca53c472="" class="file-card-container normal success"><img data-v-90c66f3f="" class="file-card-icon" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFAAAABQCAMAAAC5zwKfAAAAb1BMVEUAAACb/78WxFYXxFcXxVcYx1gWxFYWxFcWxVcbylAWxFb///9u2pWZ/7+o6cAzzGskyGHF8NXi+OpQ04Dx+/WK4qp83aDT9N9Cz3bw+/S27Mpf14te14ua5bVi55OD9a2Z5rV83qDU9N973qBf1orWRAIRAAAACnRSTlMAf++/cCCA358QmnZ8qgAAAotJREFUWMPtmAuP4iAQxz3bqjuDPPuy1d29x/f/jFc4WupZeoDmYrL+E1Mmlp8DMxlwNjO97bI9xOjbZk1FBrE6rhHzLcQDV4g7SNDRT8whCeglFts0oJd4gDSgj1hAItBHzFOBPmKWCPzwEbeJwPejhwiJYkcPEVL17iEmA/nHMtE/oSc3Unz+wrKPvi0SuCjKrpAu1v8Ankv06NTDotaBbOCJmhBCESlxqpuByBKAA6cyA4JIYK4KUcQDGWIDy0AQiDwaqBBrH7BG/BUJdBg3uv4uHmhD4YLiRBOBfj0LcHXJTxGULwh85eGz5WG/Xr5UNJAjCh+wSSmwINaOAJp4SP1YOqQEYskSgNCX6FF5hhQgMLrMEwzigE5ckRv1HCAJ6NcL+AL+RyBnbG4yxu8BKloiYimIhVfabGoG0AkxFsPLMAwDcoGjJNPeSWdViN10J5VBHtr5smnMowWg2r1OGABHPPHx0kzDgNq/TmlyhcMkzcDvxmxd5TUFkwUBCZopRm05kBS6mm+sk32tCwuKQGzc8vXn+t+O+HNGyeERBOS357gOsaStO/SEcVRCCNAt0OknGjXEWHzgtzokJBwIf4nYvLmMx17FEE8s2kMnZpG13ZSTzZnQPVRwq5biAJryyuRMcJQFLOlzpCjNExAKrGZhZkKPuPVx2oxGvxIM5HLK7HNptk1KZX9JTpkjI6oNM5Wmo6bi4Nm43FwqvXOfMGYOiQACk1fXDjWZko+VC1kE0CVeWXFrWsuFPP72pUg/86JVpL3qh6wB9/AQbT3NtGRlngZssnLXwH4MsNg8ds0HT1M3VdvC0zS9bwcfF5edp3WfqG2+0Hs+3JGBxXK/Pc8S3Nxnu7cZ5DekJ+enVwIXiwAAAABJRU5ErkJggg==" alt="csv"> <div data-v-90c66f3f="" class="file-card-info"><p data-v-90c66f3f="" class="file-card-info-name">diagnostic.csv</p> <div data-v-90c66f3f="" class="file-card-info-status"><p data-v-90c66f3f="" class="file-card-info-size">4.36 KB</p></div></div> <!----></div> <!----> <!----><!----> <div data-v-50c3a04c="" data-v-ca53c472="" class="image-thumbnail small success"><!----> <span data-v-0fac845b="" data-v-50c3a04c="" class="image-wrapper image-detail"><!----> <img data-v-0fac845b="" class="image-main is-cover" loading="lazy" alt="" src="https://www.kimi.com/apiv2-files/sign-obj/kimi-fs%2Ffiles%2Fblob%2F84423ee6123d608dc3da7a942849c82e9a12119e054388550dbd3e504d284098?filename=7zG_qz8EZb07Qj.png&amp;sig=tSZGB7HhXZYSSpsMp5rv5sXkk8C3rFB_G4CDbDCEaSg=&amp;t=t"> <!----></span> <!----></div> <!----><!----> <div data-v-50c3a04c="" data-v-ca53c472="" class="image-thumbnail small loading"><div data-v-50c3a04c="" class="image-mask"><div data-v-50c3a04c="" class="loading-icon"></div></div> <span data-v-0fac845b="" data-v-50c3a04c="" class="image-wrapper image-detail"><!----> <img data-v-0fac845b="" class="image-main is-cover" loading="lazy" alt=""> <!----></span> <!----></div> <!----><!----> <div data-v-50c3a04c="" data-v-ca53c472="" class="image-thumbnail small loading"><div data-v-50c3a04c="" class="image-mask"><div data-v-50c3a04c="" class="loading-icon"></div></div> <span data-v-0fac845b="" data-v-50c3a04c="" class="image-wrapper image-detail"><!----> <img data-v-0fac845b="" class="image-main is-cover" loading="lazy" alt=""> <!----></span> <!----></div> <!----></div></div></div></div></a>
(() => {
    function formatDate(date = new Date()) {
        return date.toISOString().split('T')[0];
    }

    function cleanMarkdown(text) {
        return text
            .replace(/\\(?![\\*_`])/g, '\\\\') // Escape backslashes
            .replace(/\n{3,}/g, '\n\n') // Clean up excessive newlines
            .replace(/&lt;/g, '<')
            .replace(/&gt;/g, '>')
            .replace(/&amp;/g, '&');
    }

    function processMessageContent(element) {
        const clone = element.cloneNode(true);
        clone.querySelectorAll('button, svg, [class*="copy"], [class*="edit"], [class*="regenerate"]').forEach(el => el.remove());

        clone.querySelectorAll('pre').forEach(pre => {
            const code = pre.innerText.trim();
            const langMatch = pre.querySelector('code')?.className?.match(/language-([a-zA-Z0-9]+)/);
            const lang = langMatch ? langMatch[1] : '';
            const codeBlock = document.createTextNode(`\n\n\`\`\`${lang}\n${code}\n\`\`\`\n`);
            pre.parentNode.replaceChild(codeBlock, pre);
        });

        clone.querySelectorAll('img, canvas').forEach(el => {
            const placeholder = document.createTextNode('[Image or Canvas]');
            el.parentNode.replaceChild(placeholder, el);
        });

        return cleanMarkdown(clone.innerText.trim());
    }

    function findMessages() {
        const selectors = [
            'div[data-message-author-role]',
            'article[data-testid*="conversation-turn"]',
            'div[data-testid="conversation-turn"]',
            'div[class*="group"]:not([class*="group"] [class*="group"])',
        ];

        let messages = [];
        for (const selector of selectors) {
            messages = document.querySelectorAll(selector);
            if (messages.length > 0) break;
        }

        if (messages.length === 0) {
            const conversationContainer = document.querySelector('[role="main"], main, .conversation, [class*="conversation"]');
            if (conversationContainer) {
                messages = conversationContainer.querySelectorAll(':scope > div, :scope > article');
            }
        }

        const validMessages = Array.from(messages).filter(msg => {
            const text = msg.textContent.trim();
            if (text.length < 30 || text.length > 100000) return false;
            if (msg.querySelector('input[type="text"], textarea')) return false;
            if (msg.classList.contains('typing') || msg.classList.contains('loading')) return false;
            const meaningfulText = text.replace(/\s+/g, ' ').trim();
            return meaningfulText.split(' ').length >= 5;
        });

        const consolidatedMessages = [];
        const usedElements = new Set();
        validMessages.forEach(msg => {
            if (usedElements.has(msg)) return;
            const isNested = validMessages.some(other =>
                other !== msg && other.contains(msg) && !usedElements.has(other)
            );
            if (!isNested) {
                consolidatedMessages.push(msg);
                usedElements.add(msg);
            }
        });

        return consolidatedMessages;
    }

    function identifySender(messageElement, index, allMessages) {
        const authorRole = messageElement.getAttribute('data-message-author-role');
        if (authorRole) return authorRole === 'user' ? 'You' : 'ChatGPT';

        const avatars = messageElement.querySelectorAll('img');
        for (const avatar of avatars) {
            const alt = avatar.alt?.toLowerCase() || '';
            const src = avatar.src?.toLowerCase() || '';
            const classes = avatar.className?.toLowerCase() || '';
            if (alt.includes('user') || src.includes('user') || classes.includes('user')) return 'You';
            if (alt.includes('chatgpt') || alt.includes('assistant') || alt.includes('gpt') ||
                src.includes('assistant') || src.includes('chatgpt') || classes.includes('assistant')) return 'ChatGPT';
        }

        const text = messageElement.textContent.toLowerCase();
        const textStart = text.substring(0, 200);
        if (textStart.match(/^(i understand|i can help|here's|i'll|let me|i'd be happy|certainly|of course)/)) return 'ChatGPT';
        if (textStart.match(/^(can you|please help|how do i|i need|i want|help me|could you)/)) return 'You';

        const hasCodeBlocks = messageElement.querySelectorAll('pre, code').length > 0;
        const hasLongText = messageElement.textContent.length > 200;
        const hasLists = messageElement.querySelectorAll('ul, ol, li').length > 0;
        if (hasCodeBlocks && hasLongText && hasLists) return 'ChatGPT';

        if (index > 0 && allMessages[index - 1]) {
            const prevText = allMessages[index - 1].textContent;
            const currentText = messageElement.textContent;
            if (prevText.length < 100 && currentText.length > 300) return 'ChatGPT';
            if (prevText.length > 300 && currentText.length < 100) return 'You';
        }

        return index % 2 === 0 ? 'You' : 'ChatGPT';
    }

    function extractConversationTitle() {
        const titleSelectors = [
            'h1:not([class*="hidden"])',
            '[class*="conversation-title"]',
            '[data-testid*="conversation-title"]',
            'title'
        ];

        for (const selector of titleSelectors) {
            const element = document.querySelector(selector);
            if (element && element.textContent.trim()) {
                const title = element.textContent.trim();
                if (!['chatgpt', 'new chat', 'untitled', 'chat'].includes(title.toLowerCase())) {
                    return title;
                }
            }
        }

        return 'Conversation_with_ChatGPT';
    }

    const messages = findMessages();
    if (messages.length === 0) {
        alert('No messages found. The page structure may have changed.');
        return;
    }

    console.log(`Processing ${messages.length} messages...`);
    const lines = [];
    const title = extractConversationTitle();
    const url = window.location.href;

    lines.push(`# ${title}\n`);
    lines.push(`**Source:** [chat.openai.com](${url})\n`);
    lines.push(`---\n`);

    const processedMessages = [];
    const seenContent = new Set();

    messages.forEach((messageElement, index) => {
        const sender = identifySender(messageElement, index, messages);
        const content = processMessageContent(messageElement);
        if (!content || content.trim().length < 30) return;
        const contentHash = content.substring(0, 100).replace(/\s+/g, ' ').trim();
        if (seenContent.has(contentHash)) return;
        seenContent.add(contentHash);
        processedMessages.push({ sender, content });
    });

    for (let i = 1; i < processedMessages.length; i++) {
        const current = processedMessages[i];
        const previous = processedMessages[i - 1];
        if (current.sender === previous.sender) {
            const currentLength = current.content.length;
            const previousLength = previous.content.length;
            if (currentLength > previousLength * 2 && currentLength > 500) {
                current.sender = 'ChatGPT';
            } else if (previousLength > currentLength * 2 && previousLength > 500) {
                previous.sender = 'ChatGPT';
                current.sender = 'You';
            } else {
                current.sender = current.sender === 'You' ? 'ChatGPT' : 'You';
            }
        }
    }

    processedMessages.forEach(({ sender, content }) => {
        lines.push(`### **${sender}**\n`);
        lines.push(content);
        lines.push('\n---\n');
    });

    const markdownContent = lines.join('\n');

    // === CUSTOM NAMING LOGIC ===
    const now = new Date();
    const timeString = now.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', hour12: true })
        .replace(':', '')
        .replace(' ', '');
    const dateString = now.toLocaleDateString('en-US', { month: '2-digit', day: '2-digit', year: 'numeric' })
        .replace(/\//g, '');
    const safeTitle = title.replace(/[^a-z0-9-_]+/gi, '_').substring(0, 80);
    const fileName = `${safeTitle}${timeString}${dateString}.md`;

    // Create and trigger download
    const blob = new Blob([markdownContent], { type: 'text/markdown' });
    const fileUrl = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = fileUrl;
    a.download = fileName;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(fileUrl);

    console.log(`âœ… Export completed: ${processedMessages.length} messages exported as ${fileName}`);
})();
